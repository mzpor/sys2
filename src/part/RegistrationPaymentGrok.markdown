# سناریوی کامل ربات ثبت‌نام و پرداخت آموزشگاه

## پیکربندی اولیه
- **توکن و API**:
  - `BOT_TOKEN = "1778171143:vD6rjJXAYidLL7hQyQkBeu5TJ9KpRd4zAKegqUt3"`
  - آدرس‌ها:
    - `API_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/getUpdates"`
    - `SEND_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/sendMessage"`
    - `BASE_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}"`
- **فایل داده**:
  - `DATA_FILE = "1.json"`
- **ذخیره‌سازی**:
  - اطلاعات کاربر در فایل JSON ذخیره می‌شود و فقط در صورت تصحیح اطلاعات به‌روزرسانی می‌شود.
  - با زدن "شروع مجدد"، وضعیت در حافظه (RAM) پاک می‌شود، اما فایل JSON دست‌نخورده باقی می‌ماند.
- **طراحی**:
  - پیام‌ها کوتاه، با ایموجی‌های 🌟، ✅، ✏️، 📍، 📱، 📋، 💸، 🎉.
  - کیبوردهای معمولی برای گزینه‌های ثابت و شیشه‌ای برای تأیید/تصحیح/مرحله بعد.
  - شماره تلفن با `request_contact: true` بدون نیاز به تأیید جداگانه.

-در اول کد پایتون محلی برای قرار دادن کانفیک دستی ایدی مدیران باشد 
مدیر وارد شد اعلام میشه شما مدیر هستید و میتوانید پنل را مشاهده کنید 
پنل  مربی ها و لیست ثبت نام قران اموز ها 
شماره ایدی و تلفن  مدیر ها برای دریافت قراناموز ثبت نام کرده و پول پرداخت کرده 
بعد از پرداخت و تایید و گرفتن لینک توسط قران اموز
یک پیام خصوصی ربات برای مدیرها میفرستد . ثبت نام کرد 
 لیست ثبت نامی ها کامل تر میشود. 
 و مدیر اماده است با پنل لیست کاربران ان را ببیند. 


لیست کلاس ها کانفیک 
قابل اصلاج توسط پنل مدیریت 
هم ارایه موقت 
هم فایل جیسون 
CLASSES = {
    "quran_recitation": {
        "name": "رشت بری",
        "price": "1,000 تومان",
        "schedule": "شنبه‌ها و سه‌شنبه‌ها ساعت 18:00",
         "subject": "lahn1 ",
          "link": "ble.ir/join/Gah9cS9LzQ "
    },
    "tajvid": {
        "name": "جاجی زاده",
        "price": "1,000 تومان",
        "schedule": "یکشنبه‌ها و چهارشنبه‌ها ساعت 20:00",
        "subject": "lahn2 ",
          "link": "ble.ir/join/Gah9cS9LzQ "
    }
}

## مرحله ۱: شروع
- کاربر دستور `/start` را وارد می‌کند.
- **چک کردن ثبت‌نام قبلی**:
  - اگر کاربر قبلاً ثبت‌نام کرده باشد (شناسه کاربر در `1.json` موجود باشد):
    - پیام:  
      _🌟 [نام کوچک] عزیز، خوش آمدید! حساب کاربری شما:  
      نام: [نام کامل]  
      کد ملی: [کد ملی]  
      تلفن: [تلفن]_  
    - کیبورد معمولی:  
      ```
      [شروع مجدد] [خروج] [کلاس]
      ```
    - کیبورد شیشه‌ای:  
      ```
      [[{text: "✏️ تصحیح ", callback_data: "edit_info"}],
       [{text: "📚 انتخاب کلاس", callback_data: "select_class"}]]
      ```
  - اگر کاربر جدید باشد:
  - کاربر `/start` را وارد می‌کند.
با زدن استارت  هم پیام هم کیبور معمولی و هم شیشه ای های زیر دیده میشه. 
   - کیبورد معمولی:  
      ```
      [شروع مجدد] [معرفی آموزشگاه] [خروج]
    - پیام:  
      _🌟 خوش آمدید! به ربات ثبت‌نام مدرسه تلاوت خوش آمدید.لطفا ابتدا ثبت نام کنید. !_  
      ```
    - کیبورد شیشه‌ای:  
      ```
      [[{text: "📝 ثبت‌نام", callback_data: "start_registration"}]]
      ```
- **اعتبارسنجی**:
  - اگر ورودی خالی یا نامعتبر باشد:  
  دوباره خوش امدگویی تقاضای ثبت نام . 
  

## مرحله ۲: دریافت نام و نام خانوادگی
- کاربر دکمه "شروع ثبت‌نام" را انتخاب می‌کند.
- پیام:  
  _لطفاً نام و نام خانوادگی خود را وارد کنید (مثال: علی رضایی)._  
- کاربر نام را وارد می‌کند (مثال: علی رضایی).
- **اعتبارسنجی**:
  - اگر ورودی خالی یا نامعتبر باشد:  
    _لطفاً نام و نام خانوادگی معتبر وارد کنید._  
- **ذخیره‌سازی**:
  - ذخیره در حافظه موقت و فایل JSON: `{"full_name": "علی رضایی", "first_name": "علی"}`.
- پیام:  
  _علی عزیز،  
  نام شما: علی رضایی  
  کد ملی: هنوز مانده  
  تلفن: هنوز مانده  

  : لطفاً کد ملی ۱۰ رقمی خود را وارد کنید._  
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✏️ تصحیح نام", callback_data: "edit_name"}]]
  ```

## مرحله ۳: دریافت کد ملی
- کاربر کد ملی را وارد می‌کند (مثال: 1234567890).
- **اعتبارسنجی**:
  - اگر کد ملی ۱۰ رقم نباشد یا فقط عدد نباشد:  
    _کد ملی نامعتبر است. لطفاً یک کد ملی ۱۰ رقمی معتبر وارد کنید._  
- **ذخیره‌سازی**:
  - ذخیره هم در حافظه موقت و هم json: `{"full_name": "علی رضایی", "first_name": "علی", "national_id": "1234567890"}`.
- پیام:  
  _علی عزیز،  
  نام شما: علی رضایی  
  کد ملی: 1234567890  
  تلفن: هنوز مانده  

  لطفاً برای ارسال شماره تلفن خود، روی دکمه زیر بزنید._  
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✏️ تصحیح کد ملی", callback_data: "edit_national_id"}],
   [{text: "📱 ارسال شماره تلفن", request_contact: true}]]
  ```

## مرحله ۴: دریافت شماره تلفن
- کاربر دکمه "ارسال شماره تلفن" را انتخاب کرده و شماره تلفن را با فرمت `989123456789` ارسال می‌کند.
- **اعتبارسنجی**:
  - اگر فرمت شماره نادرست باشد:  
    _شماره تلفن نامعتبر است. لطفاً از دکمه ارسال شماره تلفن استفاده کنید._  
- **ذخیره‌سازی**:
  - ذخیره در حافظه موقت و فایل JSON: `{"full_name": "علی رضایی", "first_name": "علی", "national_id": "1234567890", "phone": "989123456789"}`.
- پیام:  
  _📋 علی عزیز، حساب کاربری شما:  
  نام: علی رضایی  
  کد ملی: 1234567890  
  تلفن: 09123456789  

  آیا اطلاعات درست است؟_  
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✅ تأیید نهایی", callback_data: "final_confirm"}],
  [{text: "✏️ تصحیح نام", callback_data: "edit_name"}],
  [{text: "✏️ تصحیح کد ملی", callback_data: "edit_national_id"}],
  [{text: "📱 ارسال شماره تلفن", request_contact: true}]]
  ```

## مرحله ۵: تأیید نهایی ثبت‌نام
- **اگر کاربر "تأیید نهایی" را انتخاب کند**:
  - اطلاعات در فایل `1.json` ذخیره می‌شود.
  - پیام:  
    _🎉 علی عزیز، ثبت‌نام شما با موفقیت تکمیل شد! موفق باشید!_  
  - انتقال به مرحله انتخاب کلاس (مرحله ۶).
- **اگر کاربر "تصحیح " را انتخاب کند**:
  -به تصحیح مورد نظر رفته  دوباره  تصحیح ها و تایید را میبیند
  -اطلاعات جدید روی  اظلاعات قبلی ریخته میشود بدون حفظ تاریخچه  ۲ 

## مرحله ۶: انتخاب کلاس
- پس از تأیید نهایی یا اگر کاربر قبلاً ثبت‌نام کرده باشد و دکمه "انتخاب مربی" را بزند:
- پیام:  
  _🌟 [نام کوچک] عزیز، لطفاً کلاس مورد نظر خود را انتخاب کنید:_  
- کیبورد معمولی:  
  ```
  [برگشت به قبل] [شروع مجدد] [خروج]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "📚 مربی1 (۱۰۰۰ تومان)", callback_data: "couch_1_1000"}],
   [{text: "📚  مربی2 (۲۰۰۰ تومان)", callback_data: "couch_2_2000"}]]
  ```

## مرحله ۷: پرداخت
- کاربر یکی از مربی ها  را انتخاب می‌کند (مثال: "مربی1 (۱۰۰۰ تومان)").
- ربات با متد `sendInvoice` صورتحساب را ارسال می‌کند:
  - برای مربی1:  
    - عنوان: مربی1  
    - توضیحات: دسترسی به محتوای مربی1  
    - قیمت: ۱۰۰۰۰ ریال (۱۰۰۰ تومان)  
  - برای مربی2:  
    - عنوان: مربی2   
    - توضیحات: دسترسی به محتوای مربی2   
    - قیمت: ۲۰۰۰۰ ریال (۲۰۰۰ تومان)  
- **اعتبارسنجی پرداخت**:
  - اگر پرداخت ناموفق باشد:  
    _پرداخت ناموفق بود. لطفاً دوباره تلاش کنید یا با پشتیبانی تماس بگیرید._  
  - اگر پرداخت موفق باشد:
    - پیام:  
      _💸 پرداخت برای '[نام کلاس]' با موفقیت انجام شد!  
       📎 لینک ورود به گروه: ble.ir/join/Gah9cS9LzQ  
      🎉 از اینکه همراه شدید، بی‌نهایت سپاسگزاریم!_  
    - کیبورد معمولی:  
      ```
      [شروع مجدد] [خروج] [کلاس]
      ```


## دستورالعمل‌های طراحی
- **پیام‌ها**:
  - کوتاه، محترمانه، با استفاده از نام کوچک کاربر.
  - استفاده از ایموجی‌ها برای جذابیت و خوانایی.
  - فرمت ثابت:  
    _[نام کوچک] عزیز،  
    نام شما: [نام کامل]  
    کد ملی: [کد ملی یا هنوز مانده]  
    تلفن: [تلفن یا هنوز مانده]_  
- **کیبوردها**:
  - کیبورد معمولی برای گزینه‌های ثابت (شروع مجدد، خروج، برگشت به قبل).
  - کیبورد شیشه‌ای برای اقدامات خاص (تأیید، تصحیح، انتخاب کلاس).
  - دکمه شماره تلفن با `request_contact: true` برای سهولت.
- **مدیریت خطاها**:
  - پیام‌های خطا محترمانه و راهنما.
  - مثال: _لطفاً ورودی معتبر وارد کنید._  
- **ذخیره‌سازی**:
  - اطلاعات در فایل JSON به‌صورت تدریجی ذخیره می‌شود.
  - در صورت تصحیح، فقط بخش مربوطه به‌روزرسانی می‌شود.
  - "شروع مجدد" فقط حافظه موقت را پاک می‌کند.
  -اگر فایل خراب بود بک اپ گرفته و  فایل جدید ساخته شود
  -در متن برنام برای ثبت نام شده دکمه حذف حساب  باشه. وقتی حذف حساب کرد بتواند دوباره ثبت کند
  -کسی که حذف حساب میکند مثل کاربر جدید میشود 
- **گزارش‌ها**:
  - گزارش‌ها با `logging` به‌صورت انگلیسی (مثال: `INFO: User registered successfully`).
  -گزارش ها در فایل ذخیره نگردد
## نکات نهایی
- ربات باید پاسخ‌گو، کاربرپسند و بدون خطا باشد.
- فرآیند ثبت‌نام و پرداخت یکپارچه و منطقی طراحی شده است.
- تجربه کاربری زیبا با فونت مناسب بله و چیدمان منظم ارائه می‌شود.
- لینک گروه (`ble.ir/join/Gah9cS9LzQ`) فقط پس از پرداخت موفق نمایش داده می‌شود.

////////////////////
**نکته مهم**: دکمه‌های معمولی همیشه نمایش داده می‌شوند، حتی برای کاربران ثبت‌نام شده.

**تشخیص مدیر**: سیستم بررسی می‌کند که آیا شماره تلفن در لیست مدیران است یا نه.

### اگر مدیر باشد:
- پیام ویژه:  
  _👑 [نقش] عزیز،  
  نام: [نام کامل]  
  کد ملی: [کد ملی]  
  تلفن: [شماره تلفن]  
  شما به عنوان [نقش] شناسایی شدید! 🌟_  
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✅ تأیید نهایی", callback_data: "final_confirm"}]
   [{text: "✏️ تصحیح اطلاعات", callback_data: "edit_info"}]
   [{text: "👑 ورود به پنل مدیریتی", callback_data: "admin_panel"}]]
  ```

### اگر کاربر عادی باشد:
- پیام معمولی:  
  _📋 [نام کوچک] عزیز، حساب کاربری شما:  
  نام: [نام کامل]  
  کد ملی: [کد ملی]  
  تلفن: [شماره تلفن]_  
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✅ تأیید نهایی", callback_data: "final_confirm"}]
   [{text: "✏️ تصحیح اطلاعات", callback_data: "edit_info"}]]
  ```

  ## پیکربندی مدیران و مربیان



### تشخیص از طریق شماره تلفن:
```python
ADMIN_PHONES = {
    "989942878984": "مدیر",  # شماره مدیر
    "989123456789": "معاون",  # شماره معاونپ
    "989339253803": "مربی",  # شماره مربی
    #کمک مربی
    #قران اموز ویژه
}
```

### ویژگی‌های پنل مدیریتی:
- 📊 **آمار کاربران**: تعداد کل، تکمیل شده، ناقص
- 📚 **مدیریت مربی**: افزودن و اصلاح مربی
- ⚙️ **تنظیمات**: برای تنظیمات آینده
- 🔙 **بازگشت به حالت عادی**: خروج از پنل مدیریتی

## مدیریت دکمه‌های معمولی
- **معرفی آموزشگاه**: نمایش اطلاعات کامل آموزشگاه با مزایا و کلاس‌ها
- **خروج**: پیام خداحافظی
- **برگشت به قبل**: امکان برگشت به مرحله قبل در حین ثبت‌نام
- **شروع مجدد**: پاک کردن وضعیت فعلی و شروع مجدد