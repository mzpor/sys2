# سناریو ربات مدیریت گروه بله


## 1. پیکربندی اولیه
- **توکن و API**:
  - `BOT_TOKEN = "1778171143:vD6rjJXAYidLL7hQyQkBeu5TJ9KpRd4zAKegqUt3"`.
  - آدرس‌ها:
    - `API_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/getUpdates"`
    - `SEND_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/sendMessage"`
    - `BASE_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}"`
- **کتابخانه‌ها**:
  - `jdatetime`: تاریخ شمسی.
  - `requests`: ارتباط با API بله.
  - `json`: مدیریت JSON.
  - `time`: مدیریت زمان.
  - `re`: اعتبارسنجی با عبارات منظم.
  - `logging`: گزارش‌های انگلیسی.
  - `os`: بررسی فایل.
  - `sys`: مدیریت سیستم.
- اولین کاربر به‌عنوان مدیر ثبت می‌شود.
- داده‌ها در فایل JSON ذخیره و با `os` بررسی می‌شوند.
- گزارش‌ها با `logging` به‌صورت انگلیسی (مثل: `INFO: User registered`).
- کد پایتون با کامنت‌های فارسی.

## 2. مدیر
- **ورود اولیه**:
  - `/start` → پیام:  
    _🌟 خوش آمدید! به ربات مدیریت آموزشگاه قرآنی خوش آمدید! لطفاً نام و نام خانوادگی خود را وارد کنید (مثال: علی رضایی)._  
  - کیبورد معمولی: `[شروع ثبت‌نام] [خروج]`  
  - نام (علی رضایی) → JSON: `{"admin": {"full_name": "علی رضایی", "first_name": "علی"}}`  
  - پیام:  
    _علی عزیز،  
    نام شما: علی رضایی  
    تلفن: هنوز مانده_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "✏️ تصحیح نام", callback_data: "edit_admin_name"}, {text: "📱 ارسال تلفن", callback_data: "send_admin_phone"}]]
    ```
  - تلفن (`+989123456789`) → بررسی: `+98` و 13 کاراکتر.  
  - JSON: `{"admin": {"full_name": "علی رضایی", "first_name": "علی", "phone": "+989123456789"}}`  
  - پیام:  
    _🎉 علی عزیز، شما به‌عنوان مدیر ثبت شدید! پنل کاربری شما آماده است._  
  - کیبورد معمولی: `[🔁 شروع جدید] [🚫 خروج] [🧹 پاک‌سازی اطلاعات]`  
  - کیبورد شیشه‌ای: `[[{text: "📊 پنل کاربری", callback_data: "admin_panel"}]]`

- **ورود بعدی**:
  - پیام: _علی عزیز، خوش آمدید! به پنل مدیریتی دسترسی دارید._  
  - کیبورد معمولی: `[🔁 شروع جدید] [🚫 خروج] [🧹 پاک‌سازی اطلاعات]`  
  - کیبورد شیشه‌ای: `[[{text: "📊 پنل کاربری", callback_data: "admin_panel"}]]`

- **پنل مدیریتی**:
  - نمایش/افزودن/ویرایش کلاس‌ها (نام، مربی، قیمت، برنامه).
  - افزودن لینک گروه (مثل: `ble.ir/join/Gah9cS9LzQ`).
  - نمایش لیست مربیان و قرآن‌آموزان.
  - تأیید مربی/کمک‌مربی با کد رندم.

## 3. مربی/کمک‌مربی
- `/start` → پیام: _🌟 خوش آمدید! نقش خود را انتخاب کنید:_  
- کیبورد معمولی: `[مربی] [کمک‌مربی] [قرآن‌آموز]`  
- انتخاب "مربی" یا "کمک‌مربی":
  - اگر ثبت‌شده: _[نام] عزیز، شما به‌عنوان [مربی/کمک‌مربی] ثبت شده‌اید._  
  - در غیر این صورت، کد رندم (مثل: 483920) به مدیر: _درخواست ثبت مربی/کمک‌مربی: [نام]. کد تأیید: 483920_  
  - کاربر کد را وارد می‌کند.
  - پیام: _لطفاً نام و نام خانوادگی خود را وارد کنید (مثال: رضا حسینی)._  
  - JSON: `{"teachers": [{"full_name": "رضا حسینی", "first_name": "رضا", "role": "مربی"}]}`  
  - پیام:  
    _رضا عزیز،  
    نام شما: رضا حسینی  
    کد ملی: هنوز مانده  
    تلفن: هنوز مانده_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "✏️ تصحیح نام", callback_data: "edit_teacher_name"}, {text: "📍 وارد کردن کد ملی", callback_data: "enter_teacher_national_id"}]]
    ```
  - کد ملی (10 رقم) → بررسی و ذخیره.  
  - پیام:  
    _رضا عزیز،  
    نام شما: رضا حسینی  
    کد ملی: 1234567890  
    تلفن: هنوز مانده_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "✏️ تصحیح کد ملی", callback_data: "edit_teacher_national_id"}, {text: "📱 ارسال تلفن", callback_data: "send_teacher_phone"}]]
    ```
  - تلفن (`+989123456789`) → بررسی: `+98` و 13 کاراکتر.  
  - JSON: `{"teachers": [{"full_name": "رضا حسینی", "first_name": "رضا", "role": "مربی", "national_id": "1234567890", "phone": "+989123456789"}]}`  
  - اعلان به مدیر و پیام به مربی: _🎉 رضا عزیز، ثبت‌نام شما تکمیل شد!_  
  - مربی با لینک گروه وارد روم شده و ادمین می‌شود.

## 4. قرآن‌آموز
- `/start` → پیام: _🌟 خوش آمدید! ابتدا عضو کانال شوید: [https://ble.ir/info]._  
- کیبورد شیشه‌ای: `[[{text: "✅ عضو شدم", callback_data: "channel_joined"}]]`  
- پس از "عضو شدم":  
  - پیام: _لطفاً نام و نام خانوادگی خود را وارد کنید (مثال: زهرا احمدی)._  
  - JSON: `{"students": [{"full_name": "زهرا احمدی", "first_name": "زهرا"}]}`  
  - پیام:  
    _زهرا عزیز،  
    نام شما: زهرا احمدی  
    کد ملی: هنوز مانده  
    تلفن: هنوز مانده_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "✏️ تصحیح نام", callback_data: "edit_student_name"}, {text: "📍 وارد کردن کد ملی", callback_data: "enter_student_national_id"}]]
    ```
  - کد ملی (10 رقم) → بررسی و ذخیره.  
  - پیام:  
    _زهرا عزیز،  
    نام شما: زهرا احمدی  
    کد ملی: 9876543210  
    تلفن: هنوز مانده_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "✏️ تصحیح کد ملی", callback_data: "edit_student_national_id"}, {text: "📱 ارسال تلفن", callback_data: "send_student_phone"}]]
    ```
  - تلفن (`+989876543210`) → بررسی: `+98` و 13 کاراکتر.  
  - JSON: `{"students": [{"full_name": "زهرا احمدی", "first_name": "زهرا", "national_id": "9876543210", "phone": "+989876543210"}]}`  
  - پیام: _زهرا عزیز، کلاس موردنظر را انتخاب کنید:_  
  - کیبورد شیشه‌ای:  
    ```
    [[{text: "رشت بری - 1,000 تومان", callback_data: "class_quran_recitation"}, {text: "جاجی زاده - 1,000 تومان", callback_data: "class_tajvid"}]]
    ```
  - پس از انتخاب: _لطفاً هزینه را پرداخت کنید: [ble.ir/join/Gah9cS9LzQ]_  
  - پس از پرداخت (با `PAYMENT_TOKEN`): _🎉 زهرا عزیز، ثبت‌نام شما در کلاس [نام کلاس] تکمیل شد! لینک گروه: [لینک]._  
  - اعلان به مدیر و مربی.

## 5. گروه
- ورود ربات: _👋 سلام! برای استفاده از امکانات، مرا ادمین کنید. 🌟_  
- پس از ادمین شدن:  
  _📅 امروز: [شنبه، ۱ فروردین]  
  لیست قرآن‌آموزان:  
  ۱. زهرا احمدی (+989876543210)  
  برای عضویت در روم، روی /عضو ضربه بزنید._  
- با `/عضو`، لیست به‌روزرسانی می‌شود.
- اعلان به مربی: _📋 لیست ادمین‌ها: [علی رضایی]  
  لیست قرآن‌آموزان: [زهرا احمدی (+989876543210)]_

## دستورالعمل‌ها
- **پیام‌ها**: فارسی، با ایموجی‌های 🌟، ✅، ✏️، 📍، 📱، 📋، 🎉.
- **کیبوردها**: معمولی (`[🔁 شروع جدید] [🚫 خروج] [🧹 پاک‌سازی اطلاعات]`)، شیشه‌ای برای تصحیح/انتخاب.
- **JSON**: ذخیره مدیر، مربیان، کمک‌مربیان، قرآن‌آموزان، کلاس‌ها.
- **خطاها**: کد ملی (10 رقم)، تلفن (`+98`، 13 کاراکتر).
- **گزارش‌ها**: انگلیسی (مثل: `INFO: Admin registered`).
- **پرداخت**: با `PAYMENT_TOKEN`.