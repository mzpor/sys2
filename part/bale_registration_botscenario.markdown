# سناریو ربات ثبت‌نام بله (اصلاح‌شده)

## مرحله ۱: شروع
- کاربر `/start` را وارد می‌کند.
با زدن استارت  هم پیام هم کیبور معمولی و هم شیشه ای های زیر دیده میشه. 
- کیبورد معمولی:  
  ```
  [شروع مجدد] [معرفی آموزشگاه] [خروج]
- پیام:  
  _🌟 خوش آمدید! به ربات ثبت‌نام آموزشگاه خوش آمدید!_  
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "📝 شروع ثبت‌نام", callback_data: "start_registration"}]]
  ```

## مرحله ۲: دریافت نام و نام خانوادگی
- کاربر "شروع ثبت‌نام" را انتخاب می‌کند.
- پیام:  
  _لطفاً نام و نام خانوادگی خود را وارد کنید (مثال: علی رضایی)._  
- کاربر نام را وارد می‌کند (مثل: علی رضایی).
- ذخیره در JSON: `{"full_name": "علی رضایی", "first_name": "علی"}`.
- پیام:  
  _علی عزیز،  
  نام شما: علی رضایی  
  کد ملی: هنوز مانده  
  تلفن: هنوز مانده_  

 لطفاً کد ملی ۱۰ رقمی خود را وارد کنی
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✏️ تصحیح نام", callback_data: "edit_name"}]]
  ```
کاربر کد ملی را وارد میکند به مرحله بعد میرویم 

## مرحله ۳: دریافت کد ملی

- کاربر کد ملی را وارد کرده  (مثل: 1234567890).
- بررسی: اگر ۱۰ رقم نباشد، خطا: _کد ملی نامعتبر است. دوباره وارد کنید._  
- ذخیره در JSON: `{"full_name": "علی رضایی", "first_name": "علی", "national_id": "1234567890"}`.
- پیام:  
  _علی عزیز،  
  نام شما: علی رضایی  
  کد ملی: 1234567890  
  تلفن: هنوز مانده_  

   _علی عزیز، لطفاً برای ارسال شماره تلفن خود روی دکمه زیر بزنید._  
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✏️ تصحیح کد ملی", callback_data: "edit_national_id"}]
   [{text: "📱 ارسال شماره تلفن", request_contact: true}]]
  ```


## مرحله ۴: دریافت شماره تلفن
- کاربر " تلفن" را وارد کرده .

- کاربر دکمه را می‌زند و شماره تلفن با فرمت `989123456789` 
ارسال می‌شود.
- ذخیره در JSON: `{"full_name": "علی رضایی", "first_name": "علی", "national_id": "1234567890", "phone": "989123456789"}`.

## مرحله ۵: تأیید نهایی
- پیام:  
  _📋 علی عزیز، حساب کاربری شما:  
  نام: علی رضایی  
  کد ملی: 1234567890  
  تلفن: 09123456789  

  آیا اطلاعات درست است؟_  
- کیبورد معمولی:  
  ```
  [شروع مجدد] [خروج] [برگشت به قبل]
  ```
- کیبورد شیشه‌ای:  
  ```
  [[{text: "✅ تأیید نهایی", callback_data: "final_confirm"}]
  [{text: "✏️ تصحیح اطلاعات", callback_data: "edit_info"}]]
  ```
- پس از "تأیید نهایی":  
  _🎉 علی عزیز، ثبت‌نام شما با موفقیت تکمیل شد! موفق باشید!_  
- پس از "تصحیح اطلاعات": JSON پاک شده و بازگشت به مرحله ۲.

## دستورالعمل‌ها
- **پیام‌ها**: کوتاه، با نام کوچک، با ایموجی‌های 🌟، ✅، ✏️، 📍، 📱، 📋، 🎉. فرمت:  
  _[نام کوچک] عزیز،  
  نام شما: [نام کامل]  
  کد ملی: [کد ملی یا هنوز مانده]  
  تلفن: [تلفن یا هنوز مانده]_  
- **کیبوردها**: معمولی برای گزینه‌های ثابت، شیشه‌ای برای تأیید/تصحیح/مرحله بعد. تلفن با `request_contact: true` بدون تأیید جدا.
- **JSON**: ذخیره تدریجی (`full_name`, `first_name`, `national_id`, `phone`).
- **خطاها**: مدیریت ورودی‌های نامعتبر با پیام‌های محترمانه.
- **طراحی**: زیبا، خوانا، با فونت مناسب بله و چیدمان منظم.

## پیکربندی اولیه 
- **توکن و API**:
  - `BOT_TOKEN = "1778171143:vD6rjJXAYidLL7hQyQkBeu5TJ9KpRd4zAKegqUt3"`.
  - آدرس‌ها:
    - `API_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/getUpdates"`
    - `SEND_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}/sendMessage"`
    - `BASE_URL = f"https://tapi.bale.ai/bot{BOT_TOKEN}"`
- **کتابخانه‌ها**:
  - `jdatetime`: تاریخ شمسی.
  - `requests`: ارتباط با API بله.
  - `json`: مدیریت JSON.
  - `time`: مدیریت زمان.
  - `re`: اعتبارسنجی با عبارات منظم.
  - `logging`: گزارش‌های انگلیسی.
  - `os`: بررسی فایل.
  - `sys`: مدیریت سیستم.
- داده‌ها در فایل JSON ذخیره و با `os` بررسی می‌شوند.
- گزارش‌ها با `logging` به‌صورت انگلیسی (مثل: `INFO: User registered`).
- کد پایتون با کامنت‌های فارسی.

اسم فایل جیسون 
DATA_FILE = "1.json"

اطلاعات کاربر فقط در صورت تصحیح اطلاعات (مثل نام یا کد ملی) به‌روزرسانی و در فایل JSON ذخیره می‌شود.
با زدن "شروع مجدد"، فقط وضعیت در حافظه (رم) پاک می‌شود، ولی فایل 1.json دست‌نخورده باقی می‌ماند.

اگر کاربر قبلاً ثبت‌نام کرده باشد (بر اساس شناسه در فایل JSON)، پس از ورود مجدد به ربات، نام کوچک او تشخیص داده شده و پیام خوش‌آمد با جزئیات حسابش نمایش داده می‌شود.
اگر ثبت نام نکرده از اول شروع شود. 
دکمه‌هایی برای "تصحیح اطلاعات" یا "انتخاب کلاس" به او نشان داده می‌شود.