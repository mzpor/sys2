"""
ØªÙ…Ø±ÛŒÙ† 6: Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
Ø³Ø·Ø­: Ù…Ø¨ØªØ¯ÛŒ
Ù‡Ø¯Ù: Ø¢Ø´Ù†Ø§ÛŒÛŒ Ø¨Ø§ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
"""

import json
import os

def save_users_to_file():
    """
    Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± ÙØ§ÛŒÙ„
    """
    try:
        with open("users.json", "w", encoding="utf-8") as f:
            json.dump(registered_users, f, ensure_ascii=False, indent=2)
        print("âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª: {e}")

def load_users_from_file():
    """
    Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø² ÙØ§ÛŒÙ„
    """
    global registered_users
    try:
        if os.path.exists("users.json"):
            with open("users.json", "r", encoding="utf-8") as f:
                registered_users = json.load(f)
            print(f"âœ… {len(registered_users)} Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯")
        else:
            print("ğŸ“ ÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯ØŒ Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª: {e}")

def add_known_member(user_info, chat_id):
    """
    Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡
    
    Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
        user_info (dict): Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
        chat_id (int): Ø´Ù†Ø§Ø³Ù‡ Ú¯Ø±ÙˆÙ‡
    """
    if chat_id not in known_members:
        known_members[chat_id] = {}
    
    user_id = user_info.get('id')
    if user_id not in known_members[chat_id]:
        known_members[chat_id][user_id] = {
            'name': get_simple_name(user_info),
            'id': user_id,
            'added_time': time.time()
        }
        print(f"ğŸ‘¤ Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯: {get_simple_name(user_info)}")

def is_user_registered(user_id):
    """
    Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª ÛŒØ§ Ù†Ù‡
    
    Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
        user_id (int): Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
    
    Ø®Ø±ÙˆØ¬ÛŒ:
        bool: True Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    """
    return user_id in registered_users

def get_user_info(user_id):
    """
    Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
    
    Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
        user_id (int): Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
    
    Ø®Ø±ÙˆØ¬ÛŒ:
        dict: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ None
    """
    return registered_users.get(user_id)

print("âœ… ØªÙ…Ø±ÛŒÙ† 6: Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!")

# ØªØ³Øª ØªÙˆØ§Ø¨Ø¹
test_user = {"id": 12345, "first_name": "Ø¹Ù„ÛŒ", "username": "ali_user"}
add_known_member(test_user, 67890)
print(f"ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡: {len(known_members.get(67890, {}))}")

# ØªÙ…Ø±ÛŒÙ†: ØªØ§Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù„ÛŒØ³Øª Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯
# ØªÙ…Ø±ÛŒÙ†: ØªØ§Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯
# ØªÙ…Ø±ÛŒÙ†: ØªØ§Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯